{
  "name": "@local/root",
  "description": "Root - running 'firebase-jest-testing' against a sample project.",
  "license": "MIT",
  "private": true,
  "type": "module",
  "engines": {
    "node": "^14.3 || >=16 < 16.6 || >=16.6.1",
    "npm": "6 || >= 7.7.0"
  },
  "bin": {
    "active-project": "./tools/active-project.sh",
    "wait-for": "./tools/wait-for.js"
  },
  "scripts": {
    "test": "concurrently --kill-others --success=first --prefix none \"npm run start\" \"wait-for 6767 && npm run -s _test1\"",
    "_test1": "npm run -s test:fns:all && npm run -s test:rules:all",
    "-- ": "",
    "start": "firebase emulators:start --project=demo-1 | grep -v -E \"Detected demo project|You are not currently authenticated|You are not signed in to the Firebase CLI\"",
    "-- -": "",
    "//ci runs -->": "NODE=14 docker compose run test",
    "ci:test": "npm run -s test:fns:all && npm run -s test:rules:all",
    "ci:warm-up": "npm run test:fns:userInfo",
    "--  -": "",
    "test:fns:callables": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-fns/jest.config.js -f greet.test.js --verbose --detectOpenHandles --all",
    "test:fns:userInfo": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-fns/jest.config.js -f userInfo.test.js --verbose --detectOpenHandles --all",
    "test:fns:all": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-fns/jest.config.js --verbose --detectOpenHandles --all",
    "-- --": "",
    "test:rules:invites": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-rules/jest.config.js -f invitesC.test.js --verbose --detectOpenHandles --all",
    "test:rules:projects": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-rules/jest.config.js -f projectsC.test.js --verbose --detectOpenHandles --all",
    "test:rules:symbols": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-rules/jest.config.js -f symbolsC.test.js --verbose --detectOpenHandles --all",
    "test:rules:userInfo": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-rules/jest.config.js -f userInfoC.test.js --verbose --detectOpenHandles --all",
    "test:rules:visited": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-rules/jest.config.js -f visitedC.test.js --verbose --detectOpenHandles --all",
    "test:rules:all": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-rules/jest.config.js --verbose --detectOpenHandles --all",
    "--   -": "",
    "postinstall": "npm --prefix sample/functions install",
    "-- - -": "",
    "prestart": "npm run -s _checkNoActive",
    "_checkNoActive": "[ -z $BUILD_ID ] || (! active-project) || ( >&2 grep -v '^#' step-down.txt; false )",
    "--  --": "",
    "timings:1": "npm run test:fns:userInfo",
    "timings:2": "npm run test:rules:projects",
    "//timings:2": "NODE_OPTIONS=--experimental-vm-modules jest --config sample/test-rules/jest.config.js -f projectsC.test.js -t 'unauthenticated access should fail' --verbose --detectOpenHandles --all",
    "//clean": "rm -rf node_modules package/node_modules sample/functions/node_modules"
  },
  "devDependencies": {
    "@local/self": "file:.",
    "concurrently": "^6.2.2",
    "debug": "^4.3.2",
    "firebase-jest-testing": "file:package",
    "firebase-tools": "^9.19.0",
    "jest": "^27.2.4"
  },
  "//": {
    "--experimental-vm-modules": [
      "Needed for now (May 2021, ~Aug 2020~), to use native ES6 modules with Jest"
    ],
    "firebase emulators:...": [
      "If httpsCallables are among the emulated features, Cloud Functions needs a project id. The value is used in",
      "construction of the URL for the callable."
    ],
    "engines.node": [
      ">=14.3: has --harmony-top-level-await",
      ">=13.2: native ES module support",
      "",
      "Avoid 16.6.0 due to: https://github.com/facebook/jest/issues/11708"
    ],
    "engines.npm": [
      ">= 7.7.0 because of this (only matters for 'npm publish') -> https://github.com/npm/cli/issues/2834"
    ],
    "devDependencies": {
      "@local/self": [
        "Allows us to use the 'bin' section to alias commands."
      ],
      "debug": [
        "For timing the steps and seeing where Firebase Emulators are sluggish."
      ]
    },
    "scripts": {
      "wait-for 6767": [
        "The Firebase Emulator responds by 200 (OK) to a GET at its port. THIS IS GREAT - it allows us to know when",
        "it's up. However, it is likely undocumented."
      ],
      "NODE_OPTIONS=--experimental-vm-modules": [
        "Still needed on both Node.js 14 and 16. (not knowing where to track it's removal)"
      ],
      "no [[": [
        "Don't use '[[' (bash syntax). Though Windows 10+WSL2 would be using bash, the npm commands",
        "seem to be passed to plain 'sh'. '[' works."
      ],
      "//ci:test": [
        "This is just for commentary purposes, and to help develop CI workflow."
      ]
    }
  }
}
